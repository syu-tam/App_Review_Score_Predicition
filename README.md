# README

# プロジェクト概要

このプロジェクトは、アプリのユーザーレビューを分析し、その評価スコアを予測するモデルを開発したものです。データ分析コンペティションに参加するために開発され、自然言語処理とアンサンブル学習を用いて高精度な予測を目指します。

# コンペティション概要

## タスク
アプリのユーザーレビューと、レビューに対する「いいね」の数といった定量及び定性データを元に、レビュースコア（0：悪い〜4：良い）の予測を行います。

## 評価関数
モデルの予測精度は Quadratic Weighted Kappa (QWK) によって評価されます。QWKは -1 から 1 の範囲を取り、値が大きいほど予測精度が高いことを示します。

# 使用技術とモデル

- **自然言語処理 (NLP) モデル**: BERTなどの事前学習済みモデルを用い、レビューと応答テキストに対して感情分析を実施します。他のモデルへの置き換えも設定ファイル内で可能です。
- **アンサンブル学習**: LightGBM、CatBoost、XGBoost、RandomForestといったモデルを組み合わせて予測精度を向上させます。

# データ構造

評価スコアの予測に用いる特徴量は、以下のような項目で構成されます。詳細については、`data`ディレクトリ内のREADMEファイルを参考にしてください。

- **レビュー内容**: レビューの本文テキスト
- **応答内容**: レビューへの応答テキスト
- **数値特徴量**: ユーザーからの評価数やレビュー応答にかかる時間など

これらの特徴量から、テキスト処理や数値変換を通じてモデルの入力に適した形式に変換します。

# フォルダ構成

- `config/` : 設定ファイル
- `data/` :元のデータを保存するフォルダ
- `src/` : 実装スクリプト
  - `data/` : データセットの読み込み
  - `features/` : データの特徴量エンジニアリング関連
  - `models/` : 感情分析用のNLPモデルの構築と読み込み
  - `train/` : 特徴量抽出モデルの訓練とアンサンブル学習関連
  - `translate/` : テキスト翻訳
  - `utils/` : 共通関数と設定ファイルの読み込み

# セットアップ手順

1. **依存関係のインストール**: 必要なPythonパッケージをインストールします。
   ```bash
   pip install -r requirements.txt
   ```

2. **設定ファイルの確認**: `config/config.yaml`でモデルやパラメータを設定します。使用する事前学習モデルやアンサンブル学習の設定、特徴量の種類を定義しています。

3. **データの準備** データファイルを`data/`ディレクトリに配置し、設定ファイル内のパスに合わせてください。

# 実行方法

以下のコマンドでスクリプトを実行し、モデルの学習と評価を行います。
```bash
python src/main.py
```

# 各スクリプトの概要

## 1. main.py
プロジェクトのメインスクリプトで、以下のプロセスを実行します。

- データの読み込みと前処理
- NLPモデルなどを用いた特徴量抽出
- アンサンブル学習モデルの学習と評価

## 2. テキスト翻訳

- **translate.py** : 指定された言語から英語へのテキスト翻訳を行うスクリプトです。多言語形式であるレビューを英語に統一し、特徴量抽出や学習時に一貫したデータ形式で扱えるようにします。

## 3. 特徴量抽出モデルの構築
- **bert_sentiment.py**：BERTベースのカスタム感情分析モデルを定義します。このモデルを使用してレビューと応答から感情スコアを抽出し、それを特徴量として活用します。
- **model_builder.py**：`bert_sentiment.py`で定義されたモデルとトークナイザーを読み込み、設定するためのスクリプトです。特徴量抽出時に必要なモデルとトークナイザーを管理します。


## 4. 特徴量抽出モデルの学習

- **feature_extraction_train.py**：感情分析モデルをレビューと応答データで訓練し、感情スコアを高精度で抽出できるようにします。この訓練されたモデルを使って、レビュー内容を感情的に評価し、それを特徴量として使用します。

## 5. 特徴量エンジニアリング関連
- **feature_construct.py** : レビューや応答から感情スコアやキーワードの検出、訓練済みの感情分析モデルから特徴量の抽出を行い、追加します。
- **feature_utils.py** : テキストの前処理、感情スコアの抽出、次元削減（PCA）などの機能を定義しています。

## 6. アンサンブル学習関連
- **boosting_train.py** : LightGBM、CatBoost、XGBoost、RandomForestのモデルで学習し、各モデルの予測結果をアンサンブルする機能を提供します。
- **qwk.py** : Quadratic Weighted Kappa (QWK) の評価指標を計算するためのカスタムメトリクスを定義します。

# 設定ファイル (config/config.yaml)

設定ファイルには以下のパラメータが含まれています。

## 基本設定
- **base** : 共通設定項目
  - **シード値**、**GPUのデバイスID**、**ワーカー数**など、実行環境の設定を含みます。

## 特徴量抽出設定
- **feature_extraction** : 特徴量抽出に関する設定項目
  - **使用する事前学習モデル**
  - **エポック数**
  - **バッチサイズ**
  - **ドロップアウト率** など

## アンサンブル学習設定
- **boosting** : アンサンブル学習の設定項目
  - **各モデルの重み**
  - **ハイパーパラメータ** など

# 結果出力
- **出力ディレクトリ** : 学習済みモデル、メトリクス、特徴量データが指定ディレクトリに保存されます。
- **評価メトリクス** : 各エポックごとに損失、正確性、QWKスコアを計算し、CSVやグラフ形式で保存します。


